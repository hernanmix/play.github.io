<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="robots" content="noindex, nofollow, noarchive">
  <meta name="referrer" content="no-referrer">
  <title>Reproductor Live</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      background: #000;
    }
    #player {
      position: fixed;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      z-index: 9999;
    }
  </style>
</head>
<body>
  <div id="player"></div>

  <!-- JWPlayer CDN -->
  <script src="https://ssl.p.jwpcdn.com/player/v/8.26.0/jwplayer.js"></script>
  <script>
    jwplayer.key = "XSuP4qMl+9tK17QNb+4+th2Pm9AWgMO/cYH8CI0HGGr7bdjo";

    // Obtener parámetro id de la URL
    function getQueryParameter(name) {
      return new URLSearchParams(window.location.search).get(name);
    }

    function setupPlayer(jsonData) {
      const imageUrl = jsonData.img
        ? `https://disney.images.edge.bamgrid.com/ripcut-delivery/v2/variant/disney/${jsonData.img}/compose`
        : "";

      // Detectar tipo de stream
      let streamType = "dash";
      if (jsonData.url.endsWith(".m3u8")) {
        streamType = "hls";
      }

      const playerInstance = jwplayer("player").setup({
        playlist: [{
          image: imageUrl,
          sources: [{
            file: jsonData.url,
            type: streamType,
            drm: {
              clearkey: {
                keyId: jsonData.k1,
                key: jsonData.k2
              }
            }
          }]
        }],
        autostart: true,
        width: "100%",
        height: "100%",
        stretching: "uniform",   // modo normal
        skin: { name: "cyan" }
      });

      // Al entrar en fullscreen → ocupar toda la pantalla sin márgenes negros
      playerInstance.on("fullscreen", function(e) {
        if (e.fullscreen) {
          playerInstance.setConfig({ stretching: "fill" });
          if (screen.orientation && screen.orientation.lock) {
            screen.orientation.lock("landscape").catch(err => {
              console.log("No se pudo forzar orientación:", err);
            });
          }
        } else {
          playerInstance.setConfig({ stretching: "uniform" });
        }
      });
    }

    document.addEventListener("DOMContentLoaded", function () {
      const id = getQueryParameter("id");
      if (!id) {
        document.getElementById("player").innerHTML =
          "<p style='color:red'>No se encontró parámetro id</p>";
        return;
      }

      fetch("https://jstreamec.github.io/ecplaytv/final_events.json?v=" + Date.now())
        .then(response => response.json())
        .then(data => {
          const matchingItem = data.find(item => item.nombre === id);
          if (matchingItem) {
            setupPlayer(matchingItem);
          } else {
            document.getElementById("player").innerHTML =
              "<p style='color:red'>Evento no encontrado</p>";
          }
        })
        .catch(error => {
          console.error("Error cargando JSON:", error);
          document.getElementById("player").innerHTML =
            "<p style='color:red'>Error cargando transmisión</p>";
        });
    });
  </script>
</body>
</html>
